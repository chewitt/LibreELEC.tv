#!/bin/bash

# SPDX-License-Identifier: GPL-2.0-or-later
# Copyright (C) 2018-present Team LibreELEC (https://libreelec.tv)

echo "Run mkimage"

. config/options $1

# compile and copy amlogic autoscript files to part1
mcopy $RELEASE_DIR/3rdparty/bootloader/* :: 2>&1 > /dev/null || true

#for dtb in $RELEASE_DIR/3rdparty/bootloader/dtb ; do
#  [ -e "$dtb" ] && mcopy -s "$dtb" ::
#done

for file_ini in $RELEASE_DIR/3rdparty/instboot/* ; do
  [ -e "$file_ini" ] && mcopy -s "$file_ini" ::
done

echo "Installing dtb"
LINUX="$(get_build_dir linux)"
DTB="$($ROOT/$SCRIPTS/uboot_helper $PROJECT $DEVICE $UBOOT_SYSTEM dtb)"
cp -a $LINUX/arch/$TARGET_KERNEL_ARCH/boot/dts/amlogic/$DTB "$LE_TMP/dtb.img"

mcopy -s "$LE_TMP/dtb.img" ::
