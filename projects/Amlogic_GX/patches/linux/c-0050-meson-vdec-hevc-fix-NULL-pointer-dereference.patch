From dd62ade3f68dad46886d1db08bb3eac2e8683a4e Mon Sep 17 00:00:00 2001
From: Maxime Jourdan <maxi.jourdan@wanadoo.fr>
Date: Fri, 15 Jun 2018 13:09:31 +0200
Subject: [PATCH 50/50] meson: vdec: hevc: fix NULL pointer dereference

---
 drivers/media/platform/meson/vdec/codec_hevc.c | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/drivers/media/platform/meson/vdec/codec_hevc.c b/drivers/media/platform/meson/vdec/codec_hevc.c
index a89ce2e..3ecfa70 100644
--- a/drivers/media/platform/meson/vdec/codec_hevc.c
+++ b/drivers/media/platform/meson/vdec/codec_hevc.c
@@ -376,10 +376,16 @@ struct codec_hevc {
 
 static u32 codec_hevc_num_pending_bufs(struct vdec_session *sess)
 {
-	struct codec_hevc *hevc = sess->priv;
+	struct codec_hevc *hevc;
 	u32 ret;
 
 	mutex_lock(&sess->codec_lock);
+	hevc = sess->priv;
+	if (!hevc) {
+		mutex_unlock(&sess->codec_lock);
+		return 0;
+	}
+
 	ret = hevc->frames_num;
 	mutex_unlock(&sess->codec_lock);
 
-- 
2.7.4

